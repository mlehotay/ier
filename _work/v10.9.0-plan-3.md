Below is a practical, copy/paste-able **HOWTO** for using a `public/` folder in your **private repo** and syncing it to a **separate public GitHub repo** using **git subtree**.

---

## Goal

* **Private repo**: your full workspace (private code + public code)
* **Public repo**: a real, normal OSS repo on GitHub
* Everything you want public lives under: `public/`
* You can **push updates** from private → public, and optionally **pull PRs** from public → private.

---

## 0) One-time prerequisites

### Create the public GitHub repo

* Create an empty repo on GitHub (e.g., `you/myproject-public`)
* Don’t add a README/license yet (optional, but starting empty avoids confusion)

### In your private repo, add a remote for the public repo

From the root of the **private** repo:

```bash
git remote add public git@github.com:you/myproject-public.git
git fetch public
```

---

## 1) Initial setup in the private repo

### Create the `public/` folder and put “public” code in it

```bash
mkdir -p public
# move/copy the code you want to publish into public/
# e.g.:
# mv src/my_lib public/
# cp README.public.md public/README.md
git add public
git commit -m "Add initial public subtree"
```

### Push the initial public subtree to GitHub

Choose the private branch you want to publish from (usually `main`):

```bash
git subtree push --prefix=public public main
```

What this does:

* Takes **only** the contents of `public/`
* Turns it into the root of a new history
* Pushes it to the `main` branch of the **public** repo

Now your public repo should contain the contents of `public/` as if it’s a normal standalone project.

---

## 2) Day-to-day workflow (private → public)

### Work normally in private

Edit files under `public/` (and anywhere else privately). When you’re ready to release:

```bash
git add public
git commit -m "Implement feature X in public project"
```

### Publish to public repo

```bash
git subtree push --prefix=public public main
```

That’s it. Repeat as often as you want.

**Tip:** Only commits that include changes under `public/` will affect the public repo.

---

## 3) Bringing changes from the public repo back into private (public → private)

This is useful if you accept PRs on GitHub and want to sync them back into your private monorepo.

### Pull public changes into `public/`

From private repo root:

```bash
git fetch public
git subtree pull --prefix=public public main --squash
```

Notes:

* `--squash` is recommended for sanity: it imports public changes as **one** commit in the private repo, avoiding messy history interleaving.
* If you *want* full detailed history, omit `--squash` (but it can get noisy fast).

---

## 4) Recommended branch strategy

### Keep private `main` as your working integration branch

* You can publish from `main`, or from a release branch.

### Optional: publish from a dedicated branch

If you want to stage releases:

```bash
git checkout -b release-public
# finalize changes under public/
git subtree push --prefix=public public release-public
```

This lets you keep private `main` messy while only releasing from a curated branch.

---

## 5) Handling “public repo needs README/license/github workflows”

Put those **inside `public/`** in private, because they will appear at the root in public after subtree push.

Typical files to maintain under `public/`:

* `public/README.md`
* `public/LICENSE`
* `public/.gitignore`
* `public/.github/workflows/ci.yml`
* `public/CONTRIBUTING.md`

---

## 6) Safety checklist (highly recommended)

Before every publish:

* Make sure secrets are not in `public/`:

  ```bash
  rg -n "AKIA|BEGIN PRIVATE KEY|api_key|token|secret" public/
  ```
* Ensure `public/.gitignore` exists for build artifacts, `.env`, etc.
* Consider adding a `public/.env.example` instead of any real `.env`.

---

## 7) Common gotchas

### “subtree push fails because histories are unrelated”

Usually happens if the public repo already has commits (like a README from GitHub UI).

Fix: either start the public repo empty, **or** pull once first:

```bash
git subtree pull --prefix=public public main --squash
```

Then push again.

### “Why did my public repo history look different?”

Subtree creates a *derived* history for the public repo (it’s normal). Your private repo history stays intact.

### “Can I publish only some commits?”

Yes: publish from a branch that contains only the desired `public/` changes.

---

## 8) Handy aliases (optional)

```bash
git config alias.pubpush 'subtree push --prefix=public public main'
git config alias.pubpull 'subtree pull --prefix=public public main --squash'
```

Then:

```bash
git pubpush
git pubpull
```

---
